name: Build Dell NFS DKMS Driver (.deb)

on:
  workflow_dispatch:

jobs:
  build-dkms:
    runs-on: ubuntu-24.04

    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4

    - name: ğŸ§° Install Required Packages
      run: |
        sudo apt update
        sudo apt install -y build-essential dkms debhelper unzip linux-headers-generic

    - name: ğŸ“‚ Unzip Dell Driver Source
      run: |
        unzip dell-nfs-client-driver-ext-BR_MAIN.zip -d dellnfs
        find dellnfs -type f -name build.sh

    - name: ğŸ—ï¸ Build DKMS .deb
      working-directory: dellnfs/dell-nfs-client-driver-ext-BR_MAIN/
      run: |
        chmod +x build.sh
        ./build.sh dkms

    - name: ğŸ’¾ Move DEBs to /dell-debs
      run: |
        mkdir -p dell-debs
        cp dellnfs/dell-nfs-client-driver-ext-BR_MAIN/dell-nfs-client-driver-ext-BR_MAIN/dist/*.deb dell-debs/
        ls -lh dell-debs
